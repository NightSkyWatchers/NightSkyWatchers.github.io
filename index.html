<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="记录生活的点点滴滴,待岁月逝去,回首往事,嘴角扬起久违的笑容">
<meta property="og:type" content="website">
<meta property="og:title" content="FourV Zhang&#39;Blog">
<meta property="og:url" content="http://fourvcat.cc/index.html">
<meta property="og:site_name" content="FourV Zhang&#39;Blog">
<meta property="og:description" content="记录生活的点点滴滴,待岁月逝去,回首往事,嘴角扬起久违的笑容">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FourV Zhang&#39;Blog">
<meta name="twitter:description" content="记录生活的点点滴滴,待岁月逝去,回首往事,嘴角扬起久违的笑容">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://fourvcat.cc/"/>





  <title>FourV Zhang'Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ce40cd9891fcac4e463a3e1823c63f2a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">FourV Zhang'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发随记,生活随笔,读书随感,旅游随心</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/09/17/singleton是否可以这样写/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/17/singleton是否可以这样写/" itemprop="url">singleton是否可以这样写</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-17T19:21:00+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/研发随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研发随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/17/singleton是否可以这样写/" class="leancloud_visitors" data-flag-title="singleton是否可以这样写">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)shareUser &#123;</div><div class="line">static JSBUserModel *_user;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">_user = [NSKeyedUnarchiver unarchiveObjectWithFile:SavePath];</div><div class="line">if (_user == nil) &#123;</div><div class="line">_user = [JSBUserModel new];</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">return _user;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>在修改老项目的旧代码时，我和同事发现了这行几行代码！这是一个用户数据模型(userModel),用于存储用户的信息。</em></p>
<h6 id="登录获取用户数据后，转换成模型，并归档到本地。当使用的时候到本地解档！解档！单例方法中解档？WHAT-？什么鬼？"><a href="#登录获取用户数据后，转换成模型，并归档到本地。当使用的时候到本地解档！解档！单例方法中解档？WHAT-？什么鬼？" class="headerlink" title="登录获取用户数据后，转换成模型，并归档到本地。当使用的时候到本地解档！解档！单例方法中解档？WHAT ？什么鬼？"></a>登录获取用户数据后，转换成模型，并归档到本地。当使用的时候到本地解档！解档！单例方法中解档？WHAT ？什么鬼？</h6><p>疑惑：单例方法<code>shareUser</code>中的<code>dispatch_once(&amp;onceToken, ^{ xxxxxx}</code>只执行一次，如何在使用的时候本地解档呢？我们对着代码改了又改，看了又看！</p>
<p>一个上午，当我们多次<code>command + R</code>重新运行项目都需要重新输入帐号密码的时候，顿时疑惑被解开：</p>
<h6 id="单例指的是在程序运行期间存在与内存中的唯一的示例对象，当程序死掉或者被杀掉的时候，应用占用的内存会被销毁，内存中的单例自然也会被销毁掉！！"><a href="#单例指的是在程序运行期间存在与内存中的唯一的示例对象，当程序死掉或者被杀掉的时候，应用占用的内存会被销毁，内存中的单例自然也会被销毁掉！！" class="headerlink" title="单例指的是在程序运行期间存在与内存中的唯一的示例对象，当程序死掉或者被杀掉的时候，应用占用的内存会被销毁，内存中的单例自然也会被销毁掉！！"></a>单例指的是在程序运行期间存在与内存中的唯一的示例对象，当程序死掉或者被杀掉的时候，应用占用的内存会被销毁，内存中的单例自然也会被销毁掉！！</h6><h6 id="当再次启用应用的时候，会创建新的内存—新的单例实例！自然会走单例方法中-dispatch-once-amp-onceToken-xxxxxx-中的代码"><a href="#当再次启用应用的时候，会创建新的内存—新的单例实例！自然会走单例方法中-dispatch-once-amp-onceToken-xxxxxx-中的代码" class="headerlink" title="当再次启用应用的时候，会创建新的内存—新的单例实例！自然会走单例方法中`dispatch_once(&amp;onceToken, ^{ xxxxxx}中的代码"></a>当再次启用应用的时候，会创建新的内存—新的单例实例！自然会走单例方法中`dispatch_once(&amp;onceToken, ^{ xxxxxx}中的代码</h6>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/09/13/NSLog打印失效/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/13/NSLog打印失效/" itemprop="url">NSLog打印失效</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-13T19:14:00+08:00">
                2018-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/研发随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研发随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/13/NSLog打印失效/" class="leancloud_visitors" data-flag-title="NSLog打印失效">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>平时项目中都是使用DEBUG控制开发和发布状态下输出打印功能，<br>突然有一天发现系统的NSLog打印失效了，挽救方法如下：<br>在xcode项目下使用组合键<code>command + &lt;</code>打开编辑面板<img src="https://upload-images.jianshu.io/upload_images/792843-71e07ca25db36b39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="编辑面板.png"></p>
<p>添加<code>OS_ACTIVITY_MODE</code> 关键字，勾选并修改<code>value</code>值为<code>able</code>,<br>重新运行即可！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/09/04/记奇特的调试bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/04/记奇特的调试bug/" itemprop="url">记奇特的调试bug</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-04T16:21:00+08:00">
                2018-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/研发随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研发随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/04/记奇特的调试bug/" class="leancloud_visitors" data-flag-title="记奇特的调试bug">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://upload-images.jianshu.io/upload_images/792843-f7eb6b4f4afe60a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="奇特的调试bug.png"></p>
<p>传进来的model有值，并且可以打印model模型所有值；<br>但是打印model模型中的<code>title</code>、<code>image</code>、<code>sort</code>属性的时候，不是为nil，就是报错如下：<br><code>Execution was interrupted, reason: Attempted to dereference an invalid ObjC Object or send it an unrecognized selector.
The process has been returned to the state before expression evaluation</code></p>
<p>原因排查：<br>打印的<code>model</code>为一个字典<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">id = ad3886be78de49c8a6f66dfe9ba715fa,</div><div class="line">enable = 0,</div><div class="line">album = 1,</div><div class="line">delFlag = 1,</div><div class="line">ifBuy = 0,</div><div class="line">createDate = 1505893668000,</div><div class="line">vtime = ,</div><div class="line">type = 0,</div><div class="line">title = 微课堂,</div><div class="line">price = 1,</div><div class="line">image = 65617e87de1c4084ba1b78a673363b99,</div><div class="line">updateDate = 1508724726000,</div><div class="line">sort = 1</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>正确的打印出来如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">(lldb) po model.yy_modelDescription</div><div class="line">&lt; videosModel: 0x600002a75700&gt; &#123;</div><div class="line">enable = &quot;0&quot;;</div><div class="line">ifBuy = 0;</div><div class="line">image = &quot;b31e4d4ac6fd472babe9bae7c768bc0d&quot;;</div><div class="line">price = 2;</div><div class="line">title = &quot;政策解读1&quot;;</div><div class="line">type = &quot;1&quot;;</div><div class="line">videoId = &quot;4bb5310dcb9d4e7cb20aa00796da921f&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">(lldb) po model</div><div class="line">&lt; videosModel: 0x600002a75700&gt;</div></pre></td></tr></table></figure></p>
<p>排查得出结果：网络请求回来的json类型数据没有转换为模型类型！！！</p>
<p>查看模型中的声明和实现如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">.h</div><div class="line">@interface videosModel : NSObject</div><div class="line"></div><div class="line">@property (nonatomic, copy) NSString *videoId;</div><div class="line">@property (nonatomic, copy) NSString *title;</div><div class="line">@property (nonatomic, copy) NSString *type;</div><div class="line">@property (nonatomic, copy) NSString *enable;</div><div class="line">@property (nonatomic, copy) NSString *image;</div><div class="line">@property (nonatomic, assign) NSInteger ifBuy;</div><div class="line">@property (nonatomic, strong) NSNumber *price;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@interface videosListModel : NSObject</div><div class="line"></div><div class="line">@property (nonatomic, strong)  NSArray &lt; videosModel *&gt; *videos;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">.m</div><div class="line">@implementation videosModel</div><div class="line">+ (nullable NSDictionary&lt;NSString *, id&gt; *)modelCustomPropertyMapper &#123;</div><div class="line">return @&#123;@&quot;videoId&quot;:@&quot;id&quot;&#125;;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@implementation videosListModel</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>在.m文件中缺少了YYModel的类方法（自定义容器类属性映射模型类的方法）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)modelContainerPropertyGenericClass &#123;</div><div class="line">return @&#123;@&quot;videos&quot; : [videosModel class]&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/09/03/包裹BOOL值NSNumber对象和等价的三目运算区别何在/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/03/包裹BOOL值NSNumber对象和等价的三目运算区别何在/" itemprop="url">包裹BOOL值NSNumber对象和等价的三目运算区别何在</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-03T14:51:00+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/研发随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研发随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/09/03/包裹BOOL值NSNumber对象和等价的三目运算区别何在/" class="leancloud_visitors" data-flag-title="包裹BOOL值NSNumber对象和等价的三目运算区别何在">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>后台人员提供了一个网络请求接口，接口文档如下：<br><img src="https://upload-images.jianshu.io/upload_images/792843-74ca848a570e58f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="接口文档.png"><br>使用字典将参数传递过来给后台，移动端提供的参数<code>isAttention</code>是<code>BOOL</code>类型，要转换成后台所需要的<code>int</code>类型；<br>因为字典之中键值只能是对象类型，以往都是将<code>int</code>类型包装成<code>NSNumber</code>类型放在字典里进行传递，请求准确无误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">方式一    ：   &#123;@&quot;isAttention&quot;:@(isAttention)&#125;</div><div class="line">方式二    ：   [NSNumber numberWithBool:attention]</div><div class="line">方式三    ：   attention ? @1 : @0</div></pre></td></tr></table></figure></p>
<p>不巧的是，今天使用上述两种方式都报错–400.</p>
<p><code>Error Domain=NSCocoaErrorDomain Code=3840 &quot;JSON text did not start with array or object and option to allow fragments not set.&quot; UserInfo={NSDebugDescription=JSON text did not start with array or object and option to allow fragments not set., NSUnderlyingError=0x604000c51100 {Error Domain=com.alamofire.error.serialization.response Code=-1011 &quot;Request failed: bad request (400)&quot; UserInfo={NSLocalizedDescription=Request failed: bad request (400), NSErrorFailingURLKey=http://test.******.com/jsb_webserver/attention/user, com.alamofire.serialization.response.error.data = &lt;........&gt;, com.alamofire.serialization.response.error.response=&lt;NSHTTPURLResponse: 0x60400082f140&gt; { URL: http://test.******.com/jsb_webserver/attention/user } { Status Code: 400, Headers {
Connection = [
close
],
Content-Language = [
en
],
Content-Type = [
text/html;charset=utf-8
],
Content-Length = [
1003
],
Date = [
Mon, 03 Sep 2018 06:34:01 GMT
]
} }}}}</code><br>最终使用第三种方式包装<code>BOOL</code>类型参数，请求成功的！！！<br>但是本人还是有些不解，前两种写法和第三种有什么本质上的区别，<br>求大神不吝赐教！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/08/22/导航栏状态栏通透ios11适配/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/22/导航栏状态栏通透ios11适配/" itemprop="url">导航栏状态栏通透ios11适配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-22T12:01:00+08:00">
                2018-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/研发随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研发随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/08/22/导航栏状态栏通透ios11适配/" class="leancloud_visitors" data-flag-title="导航栏状态栏通透ios11适配">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://upload-images.jianshu.io/upload_images/792843-3a991a65e0378fe5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="状态栏通透.png"><br>想要实现状态栏通透的效果：<br>iOS10及以下设备设置控制器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">//  设置导航栏的背景图透明</div><div class="line">[self.navigationController.navigationBar setBackgroundImage:[UIImage new] forBarMetrics:UIBarMetricsDefault];</div><div class="line">//  设置导航栏底部线不显示</div><div class="line">[self.navigationController.navigationBar setShadowImage:[UIImage new]];</div><div class="line">self.automaticallyAdjustsScrollViewInsets = NO; // 9.0设备上</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在ios11的设备上，可以设置<code>UIScrollView</code>的<code>contentInsetAdjustmentBehavior</code>的属性；</p>
<p>例如：设置<code>tableView</code>的<code>contentInsetAdjustmentBehavior</code>的属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if (@available(iOS 11.0, *)) &#123;</div><div class="line">_tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;</div><div class="line">&#125; else &#123;</div><div class="line">// Fallback on earlier versions</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>查看这个属性的相关信息得知，将要废除，并有新的属性替换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic,assign) BOOL automaticallyAdjustsScrollViewInsets API_DEPRECATED_WITH_REPLACEMENT(&quot;Use UIScrollView&apos;s contentInsetAdjustmentBehavior instead&quot;, ios(7.0,11.0),tvos(7.0,11.0)); // Defaults to YES</div></pre></td></tr></table></figure></p>
<p><em>因为控制器的<code>automaticallyAdjustsScrollViewInsets</code>默认是YES，也就是控制器的视图会自动适应导航栏和状态栏的缩进；反之不自动适应，则从屏幕顶部开始。</em></p>
<p><code>UIScrollViewContentInsetAdjustmentBehavior</code>同理,设置<code>UIScrollViewContentInsetAdjustmentNever</code>则不自动适应，从屏幕顶部开始。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIScrollViewContentInsetAdjustmentBehavior) &#123;`</div><div class="line">UIScrollViewContentInsetAdjustmentAutomatic, // Similar to .scrollableAxes, but for backward compatibility will also adjust the top &amp; bottom contentInset when the scroll view is owned by a view controller with automaticallyAdjustsScrollViewInsets = YES inside a navigation controller, regardless of whether the scroll view is scrollable</div><div class="line">UIScrollViewContentInsetAdjustmentScrollableAxes, // Edges for scrollable axes are adjusted (i.e., contentSize.width/height &gt; frame.size.width/height or alwaysBounceHorizontal/Vertical = YES)</div><div class="line">UIScrollViewContentInsetAdjustmentNever, // contentInset is not adjusted</div><div class="line">UIScrollViewContentInsetAdjustmentAlways, // contentInset is always adjusted by the scroll view&apos;s safeAreaInsets</div><div class="line">`&#125; API_AVAILABLE(ios(11.0),tvos(11.0));</div></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/792843-b998dc2c5e32150d.gif?imageMogr2/auto-orient/strip" alt="导航栏通透.gif"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/06/07/APP上架被拒日常(6)-IPv6  网络错误/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/APP上架被拒日常(6)-IPv6  网络错误/" itemprop="url">APP上架被拒日常(6)-IPv6  网络错误</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T16:40:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/发布上架/" itemprop="url" rel="index">
                    <span itemprop="name">发布上架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/06/07/APP上架被拒日常(6)-IPv6  网络错误/" class="leancloud_visitors" data-flag-title="APP上架被拒日常(6)-IPv6  网络错误">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h4><p>We discovered one or more bugs in your app when reviewed on iPhone running iOS 11.1 on Wi-Fi connected to an IPv6 network.<br>Specifically, your app still displays a network error message and we are unable to log in.<br>Please see attached screenshots for details.<br>Next Steps<br>To resolve this issue, please run your app on a device to identify any issues, then revise and resubmit your app for review.<br>If we misunderstood the intended behavior of your app, please reply to this message in Resolution Center to provide information on how these features were intended to work.<br>For new apps, uninstall all previous versions of your app from a device, then install and follow the steps to reproduce the issue. For updates, install the new version as an update to the previous version, then follow the steps to reproduce the issue.<br>Resources<br>For information about testing your app and preparing it for review, please see Technical Note TN2431: App Testing Guide.<br>For a networking overview, please review About Networking. For a more specific overview of App Review’s IPv6 requirements, please review the IPv6 and App Review discussion on the Apple Developer Forum.</p>
<h4 id="译文"><a href="#译文" class="headerlink" title="译文:"></a>译文:</h4><p>当在连接到IPv6网络的Wi-Fi上运行ios11.1时，我们在应用程序中发现了一个或多个错误。<br>具体来说，您的应用程序仍然显示一个网络错误信息，我们无法登录。<br>详情请见附件截图。<br>下一个步骤<br>要解决这个问题，请在设备上运行您的应用程序来识别任何问题，然后修改并重新提交您的应用程序以供审查。<br>如果我们误解了您的应用程序的意图行为，请在Resolution Center中回复此消息，以提供这些特性如何工作的信息。<br>对于新的应用程序，从设备上卸载之前所有的应用程序，然后安装并执行复制问题的步骤。对于更新，将新版本作为以前版本的更新安装，然后按照以下步骤重新生成问题。<br>资源<br>有关测试您的应用程序并准备进行审查的信息，请参阅技术说明TN2431:应用程序测试指南。<br>要了解网络概况，请回顾网络。关于应用程序审查的IPv6需求的更具体的概述，请回顾一下关于苹果开发者论坛的IPv6和应用程序审查讨论。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>针对被拒内容中提到了IPv6 网络环境下,网络错误导致无法登录!</p>
<ul>
<li>首先保证登录接口/截图中展示页面内网络接口能够正常使用,以防止在苹果审核期间宕机无法使用弹出网络错误的提示框;</li>
<li>其次<a href="https://www.jianshu.com/p/02584162b79a" target="_blank" rel="external">搭建IPv6 的网络环境</a>,并且录制使用APP的视频,上传到youtube上,并获取该视频的播放地址.</li>
<li>在重新打包提交的备注信息里或者问题中心的回复框里,附带上述视频地址以及相关解释说辞,提交审核即可.</li>
</ul>
<p>附上截图:<br><img src="https://upload-images.jianshu.io/upload_images/792843-9fab5baef95e48f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="photo.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/06/07/APP上架被拒日常(5)-Payments - In-App Purchase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/APP上架被拒日常(5)-Payments - In-App Purchase/" itemprop="url">APP上架被拒日常(5)-Payments - In-App Purchase</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T16:20:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/发布上架/" itemprop="url" rel="index">
                    <span itemprop="name">发布上架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/06/07/APP上架被拒日常(5)-Payments - In-App Purchase/" class="leancloud_visitors" data-flag-title="APP上架被拒日常(5)-Payments - In-App Purchase">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="被拒-一-原文"><a href="#被拒-一-原文" class="headerlink" title="被拒(一)原文"></a>被拒(一)原文</h4><p>Hello,Thank you for providing the information. After further review, we found the following rejection:<br>We noticed that your app or its metadata enables the purchase of content, services, or functionality in the app by means other than the in-app purchase API, which is not appropriate for the App Store.<br>The next submission of this app may require a longer review time.<br>Next Steps</p>
<ul>
<li>Review the In-App Purchase section of the App Store Review Guidelines.</li>
<li>Ensure your app is compliant with all sections of the App Store Review Guidelines and the Terms &amp; Conditions of the Apple Developer Program.</li>
<li>Once your app is fully compliant, resubmit your app for review.<br>Submitting apps designed to mislead or harm customers or evade the review process may result in the termination of your Apple Developer Program account. Review the Terms &amp; Conditions of the Apple Developer Program to learn more about our policies regarding termination.<br>If you believe your app is compliant with the App Store Review Guidelines, you may submit an appeal. Alternatively, you may provide additional details about your app by replying directly to this message.</li>
</ul>
<h4 id="译文"><a href="#译文" class="headerlink" title="译文:"></a>译文:</h4><p>您好，谢谢您提供的信息。经过进一步的审查，我们发现了以下的拒绝:<br>我们注意到，你的app或它的元数据可以通过APP内购买API以外的方式购买APP中的内容、服务或功能，这并不适合APP Store。<br>这款应用的下一个提交可能需要更长的审查时间。<br>下一个步骤<br>-检查App Store内购买部分评审指南。<br>-确保您的应用程序符合app Store评审指南的所有章节以及苹果开发者计划的条款和条件。<br>-一旦你的应用完全兼容，重新提交你的应用进行审查。<br>提交旨在误导、伤害客户或逃避审查过程的应用程序，可能会导致您的Apple Developer程序帐户被终止。查看Apple Developer Program的条款和条件，了解更多关于终止的政策。<br>如果你认为你的应用程序符合app Store评审准则，你可以提出上诉。或者，您可以通过直接回复此消息来提供关于您的应用程序的其他详细信息。</p>
<h4 id="解决方案￼"><a href="#解决方案￼" class="headerlink" title="解决方案￼"></a>解决方案￼</h4><p>一. 审核期间显示会员卡，让苹果审核员使用内购买的方式 购买会员，而不是使用内购以外的 方式购买,在此基础上还有以下两种处理方式选择<br>1)被拒内容中已经发出警告：逃避审核规则，可能导致开发者帐号封禁；根据提示此次把第三方支付模块注释掉提交上线,审核通过后，再次打开第三方支付模块，以修复bug的名义上线<br>面临问题： 导致首个版本短时间内无法使用第三方支付(微信,支付宝等)</p>
<p>2)保留第三方支付模块,添加一个实体商品(类似淘宝),使用微信支付方式;需要设计一个新的UI商品界面<br>问题:时间成本比较高,业务逻辑繁琐</p>
<p>推荐方案1),我们是使用方案1)解决的问题.</p>
<p>二. 审核期间隐藏会员卡信息,审核通过后显示会员卡信息,并且不需要添加内购支付的逻辑,保留第三方支付模块代码.</p>
<p>面临问题:苹果审核可能会检测到第三方支付的相关库,譬如微信的sdk,支付宝的sdk.导致开发者帐号封禁</p>
<p>附上截图:<br><img src="https://upload-images.jianshu.io/upload_images/792843-d512e9da7f59c935.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图.png"></p>
<h4 id="被拒-二-原文"><a href="#被拒-二-原文" class="headerlink" title="被拒(二)原文"></a>被拒(二)原文</h4><p>We noticed that your app is using consumable in-app purchase products as intermediary currency for the exchange of items that function as non-renewing subscriptions.<br>Next Steps<br>To resolve this issue, please delete your consumable in-app purchase products, then create separate non-renewing subscription in-app purchase products for each item that the user would have exchanged those consumable products for. This product type matches the usage model for the products you are ultimately selling to your users.<br>Note: The product type cannot be changed once an in-app purchase product has been created. Therefore, you will need to create a new in-app purchase product with the correct product type.<br>To create new in-app purchases:</p>
<ul>
<li>Log in to iTunes Connect</li>
<li>Click on “My Apps”</li>
<li>Select your app</li>
<li>Click on “Features” to create new in-app purchases</li>
<li>Click Save</li>
<li>Once you’ve completed all changes, click the “Submit for Review” button at the top of the App Version Information page.<br>Resources<br>More information on in-app purchase product types is available in the In-App Purchase Programming Guide.</li>
</ul>
<h4 id="译文-1"><a href="#译文-1" class="headerlink" title="译文:"></a>译文:</h4><p>我们注意到，您的应用程序正在使用可消费的内购产品作为交换项目的中介货币，这些项目的功能是不可更新的订阅。<br>下一个步骤<br>为了解决这个问题，请删除您的可消费应用内购买产品，然后为用户将这些可消费产品交换的每个项目创建单独的不可更新的应用内购买产品。该产品类型与您最终销售给用户的产品的使用模型相匹配。<br>注意:在创建内购产品之后，不能更改产品类型。因此，您需要创建一个具有正确产品类型的应用程序内购买产品。<br>创建新的应用内购买:<br>-登录iTunes Connect。<br>-点击“我的应用”<br>—选择你的应用<br>-点击“功能”来创建新的内购。<br>—点击保存<br>-完成所有更改后，点击App版本信息页面顶部的“提交审核”按钮。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p><em>根据提示解决就可以,删除掉appstore类型不正确(消费类型)的内购产品,然后重新创建正确类型(非续期订阅)的内购产品即可.</em></p>
<p><img src="https://upload-images.jianshu.io/upload_images/792843-9b0833b9e54f7d61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图1.png"><br><img src="https://upload-images.jianshu.io/upload_images/792843-4134c90d9aaa52c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图2.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/06/07/APP上架被拒日常(4)- 私有API - Software Requirements/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/APP上架被拒日常(4)- 私有API - Software Requirements/" itemprop="url">APP上架被拒日常(4)- 私有API - Software Requirements</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T15:50:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/发布上架/" itemprop="url" rel="index">
                    <span itemprop="name">发布上架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/06/07/APP上架被拒日常(4)- 私有API - Software Requirements/" class="leancloud_visitors" data-flag-title="APP上架被拒日常(4)- 私有API - Software Requirements">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="原文"><a href="#原文" class="headerlink" title="原文:"></a>原文:</h4><p>Your app uses the “prefs:root=” non-public URL scheme, which is a private entity. The use of non-public APIs is not permitted on the App Store because it can lead to a poor user experience should these APIs change<br>Continuing to use or conceal non-public APIs in future submissions of this app may result in the termination of your Apple Developer account, as well as removal of all associated apps from the App Store<br>Next Steps<br>To resolve this issue, please revise your app to provide the associated functionality using public APIs or remove the functionality using the “prefs:root” or “App-Prefs:root” URL scheme.<br>If there are no alternatives for providing the functionality your app requires, you can file an enhancement request.</p>
<h4 id="译文"><a href="#译文" class="headerlink" title="译文:"></a>译文:</h4><p>您的应用程序使用“prefs:root=”非公开URL组合，这是一个私有API。应用商店不允许使用非公有api，因为如果这些api发生变化，会导致糟糕的用户体验<br>继续使用或隐藏私有API，在以后提交这个应用程序时，可能会导致你的苹果开发者账户被终止，并从应用商店中删除所有相关的应用<br>下一个步骤<br>要解决这个问题，请修改应用程序，使用公共api提供相关功能，或者删除使用“prefs:root”或“app - prefs:root”私有API相关功能。<br>如果没有提供应用程序所需功能的替代方案，您可以提交增强请求。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h4><p>1)全局搜索项目中”prefs:root”关键词字眼,并将搜索到的结果分情况删除或者注释掉或者寻找替代方法;此外如果不放心私有API问题,可以查找项目中是否存在其他私有API,如有删除掉即可.<br>此方法推荐!!!<br>2)如果通过方法1)解决了私有API的问题,但是应用内相关功能却无法实现了,就给苹果提交请求,增加新的公有API!不过此方法漫长不一定能解决问题</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/06/07/APP上架被拒日常(3)- 误判为企业应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/APP上架被拒日常(3)- 误判为企业应用/" itemprop="url">APP上架被拒日常(3)- 误判为企业应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T15:41:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/发布上架/" itemprop="url" rel="index">
                    <span itemprop="name">发布上架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/06/07/APP上架被拒日常(3)- 误判为企业应用/" class="leancloud_visitors" data-flag-title="APP上架被拒日常(3)- 误判为企业应用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="原文"><a href="#原文" class="headerlink" title="原文:"></a>原文:</h4><p>We found that your app is an in-house app, intended for employees or members of your organization. As such, it is not appropriate for the App Store.<br>For information on distributing proprietary, in-house apps, please refer to the Apple Developer Enterprise Program.</p>
<h4 id="译文"><a href="#译文" class="headerlink" title="译文:"></a>译文:</h4><p>我们发现您的APP是一个公司内部APP,用于员工或您的组织成员。因此，它并不适合应用程序商店。<br>有关分配专有的信息,企业内部应用程序,请参阅苹果开发者计划</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h4><p><em>上一次APP被拒,回复的相关内容有些片面,导致苹果审核员认为应用是一个企业应用,不适合上架到应用商店,只需要解释清楚APP是提供给哪些人群使用,不仅仅是针对公司员工,还有除员工以外的大众用户群体,则可以解决此问题</em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fourvcat.cc/2018/06/07/APP上架被拒日常(2)- Data Collection and Storage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FourV Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FourV Zhang'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/APP上架被拒日常(2)- Data Collection and Storage/" itemprop="url">APP上架被拒日常(2)- Data Collection and Storage</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T14:41:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/发布上架/" itemprop="url" rel="index">
                    <span itemprop="name">发布上架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/06/07/APP上架被拒日常(2)- Data Collection and Storage/" class="leancloud_visitors" data-flag-title="APP上架被拒日常(2)- Data Collection and Storage">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="原文"><a href="#原文" class="headerlink" title="原文:"></a>原文:</h4><p>Guideline 5.1.1 - Legal - Privacy - Data Collection and StorageWe noticed that your app requires users to register with personal information to access non account-based features. Apps cannot require user registration prior to allowing access to app content and features that are not associated specifically to the user.Please see attached screenshots for details<br>Next Steps<br>User registration that requires the sharing of personal information must be optional or tied to account-specific functionality. Additionally, the requested information must be relevant to the features.<br>Request a phone call from App Review<br>At your request, we can arrange for an Apple Representative to call you within the next three to five business days to discuss your App Review issue</p>
<h4 id="译文"><a href="#译文" class="headerlink" title="译文:"></a>译文:</h4><p>准则5.1.1 -法律-隐私保护-数据收集和存储<br>我们注意到你的应用程序需要用户通过提交个人信息注册帐号来访问一些不基于帐户之上的功能特性。应用程序不能在允许访问与用户没有特定关联的应用程序内容和特性之前要求用户注册。详情请见附件截图<br>接着下一步<br>需要共享个人信息的用户注册必须是可选的，或者绑定到特定于帐户的功能。此外，所请求的信息必须与特性相关。<br>请求App Review的电话<br>根据您的要求，我们可以安排一位苹果代表在接下来的3到5个工作日内给您打电话，讨论您的应用程序审核问题。</p>
<h4 id="复现步骤"><a href="#复现步骤" class="headerlink" title="复现步骤:"></a>复现步骤:</h4><p>游客状态,点击观看”被拒截图1”中的视频,因为涉及到视频用户授权需要用户信息,所以会弹登录注册页面</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h4><p>1)在游客状态下,隐藏这些需要用户信息的相关内容,此方法比较推荐!!!<br>2)如果隐藏实现比较繁琐的话,可以在苹果审核期间,程序内部默认一个用户cookie,从而使得游客状态访问相关信息不需要用户登录;审核通过后,使用真实帐号的cookie. 这个方法实现过程中需要注意不能改动现有其他功能的逻辑以及审核状态之间的转换,比较繁琐麻烦<br>3)请求与app review电话联系,等待在未来3–5工作日内与审核人员电话沟通解释—-游客状态下,访问相关内容为何需要登录注册.如果不登录注册会出现什么问题.磨破嘴皮子说服审核员,考验沟通技术,看运气</p>
<p>附上截图:<br><img src="https://upload-images.jianshu.io/upload_images/792843-e10aa187018c442b.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="被拒截图1.jpeg"><br><img src="https://upload-images.jianshu.io/upload_images/792843-5c50e4dee13c5edb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="被拒截图2.jpg"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="FourV Zhang" />
          <p class="site-author-name" itemprop="name">FourV Zhang</p>
           
              <p class="site-description motion-element" itemprop="description">记录生活的点点滴滴,待岁月逝去,回首往事,嘴角扬起久违的笑容</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FourV Zhang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  
    

    
  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6f2zKsw7cD3JdhRjGi9Gpof9-gzGzoHsz", "z7o6eQQPKaPp8WLIMX0bwMDj");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
